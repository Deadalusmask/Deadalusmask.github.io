<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" type="image/png" href="/favicon.png"/><meta name="theme-color" content="#000000"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta name="image" content="/favicon.png"/><title>新浪微博登录第三方应用 -Arthas.me</title><meta property="og:url" content="https://arthas.me/posts/weibo-third-party-login"/><meta property="og:type" content="article"/><meta property="og:title" content="新浪微博登录第三方应用"/><meta property="og:image" content="/favicon.png"/><meta name="twitter:title" content="新浪微博登录第三方应用"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="/favicon.png"/><meta name="twitter:creator" content="@deadalusmask"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/0a15d971913fef300597.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0a15d971913fef300597.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-67279fe62e81e3dbb4fe.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2113c6061a2f456066a1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.f771efd637e54964f7dc.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7787517220261cbe4aba.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-44fb0cf09ad137619ef8.js" as="script"/></head><body><div id="__next"><div class="page"><h3><a href="/">Arthas.me</a> / <a href="/posts">Posts</a> /</h3><h1>新浪微博登录第三方应用</h1><span>2017.10.28</span><div class="md-content"><p>通过观察网易云音乐使用微博登录时跳转的页面<a href="https://api.weibo.com/oauth2/authorize?client_id=301575942&#x26;response_type=code&#x26;redirect_uri=http://music.163.com/back/weibo&#x26;forcelogin=true&#x26;scope=friendships_groups_read,statuses_to_me_read,follow_app_official_microblog">应用授权-网易云音乐</a>，在微博账号的输入栏被填写并失去焦点后，会发送一个到 prelogin.php 的请求，请求的 url 为</p>
<div class="remark-highlight"><pre class="language-txt"><code class="language-txt">https://login.sina.com.cn/sso/prelogin.php?entry=openapi&#x26;amp;callback=sinaSSOController.preloginCallBack&#x26;amp;su=MTEx&#x26;amp;rsakt=mod&#x26;amp;checkpin=1&#x26;amp;client=ssologin.js(v1.4.18)&#x26;amp;_=1509178064363</code></pre></div>
<p>其中请求参数<code class="language-unknown">su</code>为 base64 编码的账号字符串，<code class="language-unknown">_</code>为当前时间，这里用<code class="language-unknown">int(time.time()*1000)</code>生成。</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username_quote <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote_plus<span class="token punctuation">(</span>self<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
    username_base64 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>username_quote<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    su <span class="token operator">=</span>  username_base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    prelogin_url <span class="token operator">=</span> <span class="token string">'https://login.sina.com.cn/sso/prelogin.php?entry=openapi&#x26;callback=sinaSSOController.preloginCallBack&#x26;su=%s&#x26;rsakt=mod&#x26;checkpin=1&#x26;client=ssologin.js(v1.4.18)&#x26;_=%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>su<span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>prelogin_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>meta<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"cookiejar"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>login_request<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div>
<p>请求的返回结果为：</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js">sinaSSOController<span class="token punctuation">.</span><span class="token method function property-access">preloginCallBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  retcode<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  servertime<span class="token operator">:</span> <span class="token number">1509178513</span><span class="token punctuation">,</span>
  pcid<span class="token operator">:</span> <span class="token string">"yf-db7f8e82296bf55717be22d63e61976356da"</span><span class="token punctuation">,</span>
  nonce<span class="token operator">:</span> <span class="token string">"8GLRMV"</span><span class="token punctuation">,</span>
  pubkey<span class="token operator">:</span>
    <span class="token string">"EB2A38568661887FA180BDDB5CABD5F21C7BFD59C090CB2D245A87AC253062882729293E5506350508E7F9AA3BB77F4333231490F915F6D63C55FE2F08A49B353F444AD3993CACC02DB784ABBB8E42A9B1BBFFFB38BE18D78E87A0E41B9B8F73A928EE0CCEE1F6739884B9777E4FE9E88A1BBE495927AC4A799B3181D6442443"</span><span class="token punctuation">,</span>
  rsakv<span class="token operator">:</span> <span class="token string">"1330428213"</span><span class="token punctuation">,</span>
  is_openlock<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  showpin<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  exectime<span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>
<p>使用以下代码将其中的参数转换为一个 python 的 dict:</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">res <span class="token operator">=</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"sinaSSOController.preloginCallBack"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    server_data <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre></div>
<p>使用得到的<code class="language-unknown">servertime</code>、<code class="language-unknown">nonce</code>和<code class="language-unknown">pubkey</code>参数得出 RSA 加密后的密码：</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">rsaPublickey <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>server_data<span class="token punctuation">[</span><span class="token string">'pubkey'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    key <span class="token operator">=</span> rsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">(</span>rsaPublickey<span class="token punctuation">,</span> <span class="token number">65537</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>server_data<span class="token punctuation">[</span><span class="token string">'servertime'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\t'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>server_data<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
    message <span class="token operator">=</span> message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    passwd <span class="token operator">=</span> rsa<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>message<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    passwd <span class="token operator">=</span> binascii<span class="token punctuation">.</span>b2a_hex<span class="token punctuation">(</span>passwd<span class="token punctuation">)</span>
</code></pre></div>
<p>然后就可以发送登录请求了：</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">login_url <span class="token operator">=</span> <span class="token string">'https://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.4.18)&#x26;_=%s&#x26;openapilogin=qrcode'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span>
    login_url<span class="token punctuation">,</span>
    meta<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'cookiejar'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'cookiejar'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>
    formdata<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'entry'</span><span class="token punctuation">:</span><span class="token string">'openapi'</span><span class="token punctuation">,</span>
        <span class="token string">'gateway'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'from'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'savestate'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span>
        <span class="token string">'useticket'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'pagerefer'</span><span class="token punctuation">:</span><span class="token string">'http://music.163.com/'</span><span class="token punctuation">,</span>
        <span class="token string">'ct'</span><span class="token punctuation">:</span><span class="token string">'1800'</span><span class="token punctuation">,</span>
        <span class="token string">'s'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'vsnf'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'vsnval'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'door'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'appkey'</span><span class="token punctuation">:</span><span class="token string">'u6BYq'</span><span class="token punctuation">,</span>
        <span class="token string">'su'</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>get_su<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'service'</span><span class="token punctuation">:</span><span class="token string">'miniblog'</span><span class="token punctuation">,</span>
        <span class="token string">'servertime'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>server_data<span class="token punctuation">[</span><span class="token string">'servertime'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'nonce'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>server_data<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'pwencode'</span><span class="token punctuation">:</span><span class="token string">'rsa2'</span><span class="token punctuation">,</span>
        <span class="token string">'rsakv'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>server_data<span class="token punctuation">[</span><span class="token string">'rsakv'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'sp'</span><span class="token punctuation">:</span>passwd<span class="token punctuation">,</span>
        <span class="token string">'sr'</span><span class="token punctuation">:</span><span class="token string">'1366*768'</span><span class="token punctuation">,</span>
        <span class="token string">'encoding'</span><span class="token punctuation">:</span><span class="token string">'UTF-8'</span><span class="token punctuation">,</span>
        <span class="token string">'cdult'</span><span class="token punctuation">:</span><span class="token string">'2'</span><span class="token punctuation">,</span>
        <span class="token string">'domain'</span><span class="token punctuation">:</span><span class="token string">'weibo.com'</span><span class="token punctuation">,</span>
        <span class="token string">'prelt'</span><span class="token punctuation">:</span><span class="token string">'55'</span><span class="token punctuation">,</span>
        <span class="token string">'returntype'</span><span class="token punctuation">:</span><span class="token string">'TEXT'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    callback<span class="token operator">=</span>self<span class="token punctuation">.</span>authorize_request<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>然后是对网易云音乐的授权，请求表单需要提供登录成功返回的<code class="language-unknown">ticket</code>值：</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">authorize_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response_json <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    authorize_url <span class="token operator">=</span> <span class="token string">'https://api.weibo.com/oauth2/authorize'</span>
    <span class="token keyword">return</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span>authorize_url<span class="token punctuation">,</span>
        headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>
        meta<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'cookiejar'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'cookiejar'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        formdata<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'action'</span><span class="token punctuation">:</span><span class="token string">'login'</span><span class="token punctuation">,</span>
            <span class="token string">'display'</span><span class="token punctuation">:</span><span class="token string">'default'</span><span class="token punctuation">,</span>
            <span class="token string">'withOfficalFlag'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span>
            <span class="token string">'quick_auth'</span><span class="token punctuation">:</span><span class="token string">'false'</span><span class="token punctuation">,</span>
            <span class="token string">'withOfficalAccount'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string">'scope'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string">'ticket'</span><span class="token punctuation">:</span>response_json<span class="token punctuation">[</span><span class="token string">'ticket'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'isLoginSina'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string">'response_type'</span><span class="token punctuation">:</span><span class="token string">'code'</span><span class="token punctuation">,</span>
            <span class="token string">'regCallback'</span><span class="token punctuation">:</span><span class="token string">'https://api.weibo.com/oauth2/authorize?client_id=301575942&#x26;response_type=code&#x26;redirect_uri=http://music.163.com/back/weibo&#x26;forcelogin=true&#x26;scope=friendships_groups_read,statuses_to_me_read,follow_app_official_microblog'</span><span class="token punctuation">,</span>
            <span class="token string">'redirect_uri'</span><span class="token punctuation">:</span><span class="token string">'http://music.163.com/back/weibo'</span><span class="token punctuation">,</span>
            <span class="token string">'client_id'</span><span class="token punctuation">:</span><span class="token string">'301575942'</span><span class="token punctuation">,</span>
            <span class="token string">'appkey62'</span><span class="token punctuation">:</span><span class="token string">'u6BYq'</span><span class="token punctuation">,</span>
            <span class="token string">'state'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string">'verifyToken'</span><span class="token punctuation">:</span><span class="token string">'null'</span><span class="token punctuation">,</span>
            <span class="token string">'from'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string">'switchLogin'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span>
            <span class="token string">'userId'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token string">'passwd'</span><span class="token punctuation">:</span><span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        callback<span class="token operator">=</span>do_something<span class="token punctuation">)</span>
</code></pre></div>
<p>授权成功后会跳转到<code class="language-unknown">http://music.163.com/back/sns</code>,返回了网易云音乐用户的 uid 和一些信息，大功告成~</p></div><hr class="hr"/><div style="display:flex;justify-content:space-between"><a style="margin-right:24px" href="/posts/Laravel-passport-for-api-auth">使用laravel/passport的客户端api认证</a><a href="/posts/winter-vacation-daily">寒假日常</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"新浪微博登录第三方应用","date":1509204819000,"slug":"weibo-third-party-login","content":"\u003cp\u003e通过观察网易云音乐使用微博登录时跳转的页面\u003ca href=\"https://api.weibo.com/oauth2/authorize?client_id=301575942\u0026#x26;response_type=code\u0026#x26;redirect_uri=http://music.163.com/back/weibo\u0026#x26;forcelogin=true\u0026#x26;scope=friendships_groups_read,statuses_to_me_read,follow_app_official_microblog\"\u003e应用授权-网易云音乐\u003c/a\u003e，在微博账号的输入栏被填写并失去焦点后，会发送一个到 prelogin.php 的请求，请求的 url 为\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-txt\"\u003e\u003ccode class=\"language-txt\"\u003ehttps://login.sina.com.cn/sso/prelogin.php?entry=openapi\u0026#x26;amp;callback=sinaSSOController.preloginCallBack\u0026#x26;amp;su=MTEx\u0026#x26;amp;rsakt=mod\u0026#x26;amp;checkpin=1\u0026#x26;amp;client=ssologin.js(v1.4.18)\u0026#x26;amp;_=1509178064363\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e其中请求参数\u003ccode class=\"language-unknown\"\u003esu\u003c/code\u003e为 base64 编码的账号字符串，\u003ccode class=\"language-unknown\"\u003e_\u003c/code\u003e为当前时间，这里用\u003ccode class=\"language-unknown\"\u003eint(time.time()*1000)\u003c/code\u003e生成。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003estart_requests\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    username_quote \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e urllib\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparse\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003equote_plus\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eusername\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    username_base64 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e base64\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eb64encode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eusername_quote\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eencode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    su \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e  username_base64\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edecode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    prelogin_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'https://login.sina.com.cn/sso/prelogin.php?entry=openapi\u0026#x26;callback=sinaSSOController.preloginCallBack\u0026#x26;su=%s\u0026#x26;rsakt=mod\u0026#x26;checkpin=1\u0026#x26;client=ssologin.js(v1.4.18)\u0026#x26;_=%s'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esu\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003escrapy\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRequest\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprelogin_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eheaders\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheaders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003emeta\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"cookiejar\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ecallback\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elogin_request\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e请求的返回结果为：\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003esinaSSOController\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epreloginCallBack\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  retcode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  servertime\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1509178513\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  pcid\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"yf-db7f8e82296bf55717be22d63e61976356da\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  nonce\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"8GLRMV\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  pubkey\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"EB2A38568661887FA180BDDB5CABD5F21C7BFD59C090CB2D245A87AC253062882729293E5506350508E7F9AA3BB77F4333231490F915F6D63C55FE2F08A49B353F444AD3993CACC02DB784ABBB8E42A9B1BBFFFB38BE18D78E87A0E41B9B8F73A928EE0CCEE1F6739884B9777E4FE9E88A1BBE495927AC4A799B3181D6442443\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  rsakv\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1330428213\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  is_openlock\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  showpin\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  exectime\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e23\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e使用以下代码将其中的参数转换为一个 python 的 dict:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003eres \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ereplace\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"sinaSSOController.preloginCallBack\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    server_data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eeval\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eres\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e使用得到的\u003ccode class=\"language-unknown\"\u003eservertime\u003c/code\u003e、\u003ccode class=\"language-unknown\"\u003enonce\u003c/code\u003e和\u003ccode class=\"language-unknown\"\u003epubkey\u003c/code\u003e参数得出 RSA 加密后的密码：\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003ersaPublickey \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserver_data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'pubkey'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    key \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e rsa\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePublicKey\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ersaPublickey\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e65537\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    message \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserver_data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'servertime'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\\t'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserver_data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'nonce'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\\n'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epassword\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    message \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e message\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eencode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    passwd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e rsa\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eencrypt\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e key\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    passwd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e binascii\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eb2a_hex\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epasswd\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e然后就可以发送登录请求了：\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003elogin_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'https://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.4.18)\u0026#x26;_=%s\u0026#x26;openapilogin=qrcode'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nscrapy\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFormRequest\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    login_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    meta\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e'cookiejar'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emeta\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'cookiejar'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    headers\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheaders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    formdata\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'entry'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'openapi'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'gateway'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'1'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'from'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'savestate'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'0'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'useticket'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'1'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'pagerefer'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'http://music.163.com/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'ct'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'1800'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e's'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'1'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'vsnf'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'1'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'vsnval'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'door'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'appkey'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'u6BYq'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'su'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eget_su\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'service'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'miniblog'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'servertime'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserver_data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'servertime'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'nonce'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserver_data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'nonce'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'pwencode'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'rsa2'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'rsakv'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserver_data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'rsakv'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'sp'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003epasswd\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'sr'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'1366*768'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'encoding'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'UTF-8'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'cdult'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'2'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'domain'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'weibo.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'prelt'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'55'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'returntype'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'TEXT'\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    callback\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eauthorize_request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e然后是对网易云音乐的授权，请求表单需要提供登录成功返回的\u003ccode class=\"language-unknown\"\u003eticket\u003c/code\u003e值：\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eauthorize_request\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eresponse\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    response_json \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e json\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloads\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    authorize_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'https://api.weibo.com/oauth2/authorize'\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e scrapy\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFormRequest\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eauthorize_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        headers\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheaders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        meta\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e'cookiejar'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emeta\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'cookiejar'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        formdata\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'action'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'login'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'display'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'default'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'withOfficalFlag'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'0'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'quick_auth'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'false'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'withOfficalAccount'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'scope'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'ticket'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003eresponse_json\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'ticket'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'isLoginSina'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'response_type'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'code'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'regCallback'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'https://api.weibo.com/oauth2/authorize?client_id=301575942\u0026#x26;response_type=code\u0026#x26;redirect_uri=http://music.163.com/back/weibo\u0026#x26;forcelogin=true\u0026#x26;scope=friendships_groups_read,statuses_to_me_read,follow_app_official_microblog'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'redirect_uri'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'http://music.163.com/back/weibo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'client_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'301575942'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'appkey62'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'u6BYq'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'state'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'verifyToken'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'null'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'from'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'switchLogin'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e'0'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'userId'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'passwd'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        callback\u003cspan class=\"token operator\"\u003e=\u003c/span\u003edo_something\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e授权成功后会跳转到\u003ccode class=\"language-unknown\"\u003ehttp://music.163.com/back/sns\u003c/code\u003e,返回了网易云音乐用户的 uid 和一些信息，大功告成~\u003c/p\u003e"},"prev":{"slug":"Laravel-passport-for-api-auth","title":"使用laravel/passport的客户端api认证","date":1477604930000},"next":{"slug":"winter-vacation-daily","title":"寒假日常","date":1519837064000}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"weibo-third-party-login"},"buildId":"1EFwxkPp7d779ZeTLfDNk","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-a98cee78eb8282e29fb6.js"></script><script src="/_next/static/chunks/main-67279fe62e81e3dbb4fe.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.2113c6061a2f456066a1.js" async=""></script><script src="/_next/static/chunks/commons.f771efd637e54964f7dc.js" async=""></script><script src="/_next/static/chunks/pages/_app-7787517220261cbe4aba.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-44fb0cf09ad137619ef8.js" async=""></script><script src="/_next/static/1EFwxkPp7d779ZeTLfDNk/_buildManifest.js" async=""></script><script src="/_next/static/1EFwxkPp7d779ZeTLfDNk/_ssgManifest.js" async=""></script></body></html>